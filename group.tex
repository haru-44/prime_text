Fermatの小定理は、群という枠組みで考えると、新たな発見を与えてくれる。
そのために、群を導入しよう。

深い議論、より本質を見つけるためには、抽象化ということをしなければならない。
あるいは記号の羅列にしか見えないそれは、数学が嫌いな人からすればアレルギー反応を起こすこと必定だ。
そういう人たちは、数学とは自然界を写し取った世界であり、人工物が混入することを忌避する信念を持っているように思える。
しかし、「数」それ自体が人工物であるわけで、矛盾をはらんでいる。

\begin{quote}
``数"は、人間の認知能力を補完し、延長するために生み出された道具である(中略)。
「自然数(natural number)」という言葉があるが、それは決してあらかじめどこかに「自然に」存在しているわけではない。
「自然」と呼ばれるのは、もはや道具であることを意識させないほどに、それが高度に身体化されているからである。 | 森田真生『数学する身体』\cite{math_body}
\end{quote}

科学は「同じようなもの」を見いだし、それを「同じ」と認識することによって発展してきたとも言える。
例えば、ペン1本とノート1冊には何の関係性もないが、それを、同じ「1」と認識できるのである。
同じように、足し算とか掛け算とかの「骨」である部分を抜き出すのだ。
そして、この「骨」を「群」と名付けたのである。
当初は、「なぜ5次以上の方程式の解を求める公式が存在しないのか」という疑問に応えるために創り出された道具だった。
時代が下るにつれて、暗号理論や誤り訂正符号などの情報技術の根幹を成す理論に利用され、果てはこの世界の根源を探る素粒子物理学にも利用されている。
こんなことを言うと、「群」は恐ろしく複雑で難解なのではないか、と思うかも知れない。
そんな予想に反して、(少なくとも)複雑とは言い難い。
むしろ、貧相な見た目であるとも言える。
それにも関わらず、誕生から200年以上にも渡って科学者を飽きさせないエンターテイナーであるのだ。

そんな「群」について学ぼう。
最初のイメージとして、足し算や掛け算を抽象化したものを「群」と呼ぶ。
定義もなしに言ってしまうけれど、整数上での足し算は群を成す。
あるいは、有理数上での掛け算は群を成す。
このように、舞台となる整数であったり有理数であったりといった集合と、そこでの振る舞いが一定の条件を満たしていれば群と呼べる。
逆に言えば、この条件を満たしていれば、足し算や掛け算に似ていなくとも、群と呼べるのである\Notes{ここでは取り上げないが、阿弥陀くじやルービックキューブなどは、群の理論で説明できる。}。
一方で条件を満たしていない、自然数上での足し算や整数上での掛け算は、群とは呼べないのである。
この辺りは、定義を述べてから詳しく見ていこう。
足し算も掛け算も一緒くたに扱うのが群なのであるが、足し算と掛け算の類似性を見るには、$0$と$1$に着目しよう。
足し算における$0$と、掛け算における$1$は、どんな数に$0$を足しても(あるいは$1$を掛けても)変化しないという意味で似通っている。
これを\IND{単位元}{たんいけん}(identity element)と呼び、単位元が存在することが群であるための条件の1つとなっている。

ともかく、群を真面目に定義してみよう。
つまり、\kenten{分かり切っていることを大仰に書き下す}のである。
まずは、二項演算を定義する。

\begin{Defi}{\IND{二項演算}{にこうえんさん}, binary operation}{binary-operation}
集合$G$上で定義される写像
\begin{align*}
\mu : G \times G \to G
\end{align*}
を$G$上の二項演算と呼び、特に$\mu(x,y)=z$を$x\circ_{\mu}y=z$と書き、二項演算を$\circ_{\mu}$とする記法が一般的である。
\end{Defi}

小学校以来習ってきた足し算や掛け算は、2変数関数と同一視できるのである\Notes{というか、書き方の違いだけで本質的には何ら違わない}。
また、演算が\textbf{閉じている}とは$G\times{G}$の行き先が必ず$G$であることであり、$g_1\circ{g_2}\not\in{G}$となるような$g_1,g_2\in{G}$が存在するときには演算が閉じているとは言わない。
例えば、自然数同士の足し算は、常に自然数となるので閉じていると言えるが、自然数同士の引き算は、例えば$3-5$は自然数にはならないので、閉じていない。

\begin{Defi}{\IND{元}{けん}, element}{element}
群$G$において、$G$の要素を元と呼ぶ。
\end{Defi}

群は、集合と二項演算の組によって決まる。

\begin{Defi}{\IND{群}{くん}, group}{group}
集合$G$と二項演算$+$の組$(G,+)$について次の4つの条件が成り立つとき$(G,+)$を\textbf{群}と呼ぶ。
\begin{enumerate}
 \item 二項演算$+$について集合$G$は閉じている。
 \item (\textbf{結合法則})任意の$a,b,c{\in}G$について$(a{+}b){+}c=a{+}(b{+}c)$が成り立つ。
 \item (\textbf{単位元}の存在)任意の$a{\in}G$について$a{+}e_+=e_+{+}a=a$となる単位元$e_+\in{G}$が存在する。
 \item (\textbf{逆元}の存在)任意の$a{\in}G$について$a{+}(-a)=(-a){+}a=e_+$となる逆元$-a\in{G}$が存在する。
\end{enumerate}
\end{Defi}

特に、群$(G,+)$が任意の$a,b{\in}G$で
\begin{eqnarray*}
a + b = b + a
\end{eqnarray*}
ならば、$(G,+)$を\IND{可換群}{かかんくん}(commutative group)と呼ぶ。
また、慣例的に加法について群ならば加法群と呼び、逆元を$-a$、単位元を0と表し、乗法について群ならば乗法群と呼び、逆元を$a^{-1}$、単位元を1と表すが、本質的に違いはない。
同様に、スカラー倍についても表記上の差異が見られる。
加法群$(G,+)$ならば$a\in{G}$と非負整数$k$について
\begin{eqnarray*}
ka=
\begin{cases}
a + (k-1)a, & \mbox{if } k > 0\\
0, & \mbox{otherwise}
\end{cases}
\end{eqnarray*}
であるが、乗法群$(G,\times)$ならば
\begin{eqnarray*}
a^{k}=
\begin{cases}
a \times a^{k-1}, & \mbox{if } k > 0\\
1, & \mbox{otherwise}
\end{cases}
\end{eqnarray*}
と表されるのが通例である。

集合$G$に加えて二項演算$+$も明らかにならなければ群と呼べないのだが、大抵「群$G$」と書かれ、二項演算の記載は省略される。
ここでも、以降はそのように表す。

\begin{Defi}{群の\IND{位数}{いすう}, order}{group_order}
群$G$の位数とは、$G$の元の要素数であり、$|G|$と書く。
\end{Defi}

位数には、群の位数と、後で紹介する元の位数があり、まったく別物であるから、注意が必要である。

いくつかの具体例を見てみよう。
\begin{align*}
\mathbb{Z}_n = \{0,1, \ldots, n-1\}
\end{align*}
という集合は加法について群である。
ただし、通常の意味での加法ではもちろん演算について閉じていないから、ここでの加法の後に$n$で剰余算をする。

復習すると剰余算について、$a$を$n$で割った余りを$b$とすることを、$a \% n =b$と書くことにすると、
\begin{align*}
(a \% n) + (b \% n) &= (a + b) \% n\\
(a \% n) - (b \% n) &= (a - b) \% n\\
(a \% n) \times (b \% n) &= (a \times b) \% n\\
\end{align*}
が成り立ったのであった。
つまり、剰余の順番は気にせずに良い。よって、$(\mathbb{Z}_n,+)$は(剰余算をする)加法において群を成す。

では、同じように乗法についても群となるのではないかという予想ができるが、そうではない。

\begin{Prop}{}{inverse_element_not_exists}
$a,n\in\mathbb{Z}$が互いに素であるとき、かつそのときのみ$ax=1\pmod{n}$となるような$x$が存在する。
\end{Prop}

つまり、$a$と$n$が互いに素でないと、逆元が存在しないのである。
例えば、$a=4,n=12$のとき、$ax \% n =1$となるような$x$が存在しないため$\mathbb{Z}_{12}$は群にならない。
ちなみに、逆元を持つ元を\IND{可逆元}{かきやくけん}(invertible element)あるいは\IND{単元}{たんけん}(unit)と呼ぶ。
換言すれば、群はすべての要素が可逆元である。

逆元を求めるには、拡張Euclidの互除法を使えばよい。
具体的には次のようになる。

\Algo{逆元}{inverse_mod}{c.f., \rAlgo{extended_gcd}}

この事実を逆に考えればこのような、単元ではない元を除けば群になるとも言える。
そこで、次のような集合を定義する。

\begin{align*}
\mathbb{Z}_n^* = \{a : a \in \mathbb{Z}_n, \gcd(a,n) = 1\}
\end{align*}

$(\mathbb{Z}_n^*,\times)$は乗法において群を成し、この群を\IND{既約剰余類}{きやくしようよるい}と呼ぶ。
特に$n$が素数$p$の場合は、$0$以外すべての要素が$p$と互いに素である。

\begin{Exam}{}{kiyaku_jouyo}
\begin{align*}
\mathbb{Z}^*_5 &= \{1, 2, 3, 4\}\\
\mathbb{Z}^*_{12} &= \{1, 5, 7, 11\}\\
\mathbb{Z}^*_{15} &= \{1,2,4,7,8,11,13,14\}
\end{align*}
\end{Exam}

さて、Fermatの小定理を群の言葉で書き直そう。
$\bmod{n}$における現象は、$\mathbb{Z}_n^*$という群における現象に過ぎないのだ。

\begin{Theo}{}{group_ord}
群$G$と任意の元$a\in G$において、次が成り立つ。
\begin{align*}
a^{|G|} = e
\end{align*}
ここで、$|G|$は群の位数、$e$は群$G$の単位元とする。
\end{Theo}

\begin{thProof}{group_ord}
可換群の場合について証明する。
$G$の元すべてに$a\in{G}$をかけた集合$aG$を考える。
この$aG=\{ax:x\in{G}\}$は$G$に一致する。
なぜなら、群の定義より任意の$a,b,c\in{G}$について$ab\neq{ac}$が言えるので、$aG$は$G$がシャッフルしただけで、被りがない。
よって、当然$G$の総積と$aG$の総積は一致する。
\begin{align*}
\prod_{g\in{G}}g = \prod_{g\in{aG}}g
\end{align*}
分かりやすく書くならば、$G=\{g_1,g_2,\ldots,g_n\}$ということにして、
\begin{align*}
g_1g_2\cdots g_n = ag_1 ag_2 \cdots ag_n
\end{align*}
と言うことである。
ここで、$a$は$|G|$個あるから全て集めてきて
\begin{align*}
g_1g_2\cdots g_n = a^{|G|}g_1 g_2 \cdots g_n
\end{align*}
となり、両辺を$g_1g_2\cdots{g_n}$で割ると$a^{|G|}=e$を得る。
\end{thProof}

例えば、$G$を$\mathbb{Z}_n$とすれば、
\begin{align*}
an \equiv 0 \pmod{n}
\end{align*}
という当たり前の結果に過ぎない。
また、$G$を$\mathbb{Z}^*_p$(ただし、$p$は素数)とすれば、$|G|=p-1$であるから、
\begin{align*}
a^{p-1} \equiv 1 \pmod{p}
\end{align*}
となり、Fermatの小定理に一致する。

では、一般の$n$の場合$\mathbb{Z}^*_n$はどうなるだろうか？　$\mathbb{Z}^*_n$の位数とは、定義より$n$と互いに素な整数の個数になる。これを新しく$\varphi(n)$と定義しよう。

\begin{Defi}{\IND{Eulerの$\varphi$関数}{Eulerの$\varphi$かんすう}, Euler's totient function}{varphi}
正整数$n$に対して、$n$以下の、$n$と互いに素な整数の個数を$\varphi(n)$とする。
\end{Defi}

そうすると、任意の$n$と互いに素な$a$について、次が成り立つことが分かる。
\begin{align*}
a^{\varphi(n)} \equiv 1 \pmod{n}
\end{align*}
とは言え、これでは$|G|$を$\varphi(n)$に置き換えただけで、情報が増えていないのだが、$\varphi(n)$は次のように計算できる。

\begin{Theo}{}{}
$n$が$n=p_1^{e_1}p_2^{e_2}\cdots p_r^{e_r}$と素因数分解できるとき、$\varphi(n)$は次のように計算できる。
\begin{align*}
\varphi(n) = n \prod_{k=1}^r \left( 1 - \frac{1}{p_k} \right)
\end{align*}
\end{Theo}

計算できると言ったが、中身を見れば分かる通り、まず$n$を素因数分解する必要がある。
\ruby{巷}{ちまた}ではよく、RSA暗号は素因数分解問題が難しいため安全という解説がなされる。
それは、「素因数分解→$\varphi(n)$の計算→RSA暗号解読」という手順によってなされるわけであるが、$\varphi(n)$の計算に素因数分解が必須であるかは分かっていない。
つまり、素因数分解をしなくとも$\varphi(n)$を計算できる可能性があって、素因数分解問題が難しいままでも、RSA暗号を解読することが可能かもしれない。


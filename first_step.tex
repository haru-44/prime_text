まずは、素数とは何かをはっきりさせよう。
\IND{素数}{そすう}(prime)とは、1より大きな整数で、1とそれ自身以外では割り切ることができない数である。
具体的には、$2,3,5,7,11\ldots$などがそうである。

定義をうろ覚えの内は、「1は素数なのか？」と訊かれると戸惑ってしまいがちだが、1は素数ではない。
定義に立ち帰ってみると、\textbf{1より大きい}とわざわざ仲間外れにしていることがその根拠だ。
\kenten{1を作為的に素数から除外する}のは、後で述べる素因数分解の一意性を説明する上で都合が良いからであるが、ここでモヤっとする初学者が多いことも確かだ。
\IND{定義}{ていき}(definition)とは、概念に対する単なる「名付け」に過ぎない。
夜空に瞬く、ある星たちを「はくちょう座」と呼ぶことに、何ら物理法則が関与しないように、素数もまた人類が認識しやすいように切り取られた一つの概念に過ぎない。
似ている言葉に\IND{定理}{ていり}(theorem)があるが、こちらは命題の一種であって、まったく別物である。

「定義」について理解したところで、どのような数が素数なのか、ということを確認したい。

\begin{itemize}
 \item $2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47$は50以下のすべての素数である。
 \item $4, 12, 99$は素数ではない。なぜならば、それぞれ$2, 3, 11$で割り切れるからである。
\end{itemize}

素数でない整数を、いちいち「素数ではない整数」などと呼ぶことは不便だ\Notes{不便だからこそ、「定義する」という行為が行われるのである。}。
そこで、$1$でも素数でもない自然数は\IND{合成数}{こうせいすう}(composite number)と呼ぶこととする。

\IND{整数}{せいすう}(integer)と\IND{自然数}{しせんすう}(natural number)も慣れていないと\ruby{躓}{つまづ}いてしまう。
整数とは$\ldots,-2,-1,0,1,2,\ldots$と続く数で、自然数は$1,2,3,\ldots$と続く数である\Notes{自然数にゼロを含める流儀もあるが、本稿では含めないとする}。
それぞれ、$\mathbb{Z}$と$\mathbb{N}$という記号で書くこともあるが、記号の氾濫は混乱を招くだろうし、適宜補足するから、一旦読み飛ばしてもいい。

素数が発明されたのは、数の最小単位としての意味合いがある。
人類は物質の最小単位を夢想し、原子や素粒子を見つけてきたが、同じように、$1,2,3,4,\ldots$と続く自然数を掛け算でバラバラにすると、素数が現れる。

\begin{Theo}{\IND{素因数分解の一意性}{そいんすうふんかいのいちいせい}, unique factorization theorem}{unique_factorization_theorem}
$1$以外の正整数\Notes{正整数、あるいは非負整数は、その名の通り$1,2,3,\ldots$と続く数であり、ゼロを除いたときの自然数と同じだ。混乱を招くが、同じ概念に対して複数の用語があてがわれていることは往々にしてある。}は、因子\Notes{「因子」も未定義だが、もう少し後で説明するのでご愛嬌。}の順番の違いを除いて、素数の積としてただ一通りに表すことができる。
\end{Theo}

$15$は$3\times5$という分解しかありえない。
逆に、$5$と$7$の積は常に$35$であって、$36$や$43$になったりしない。
掛け算を習った小学生なら、証明という概念こそないとはいえ、当たり前に受け入れる内容だろう。

では、この数の原子はどれほど存在するのか？　原子には周期表が作られたが、素数はカタログにまとめられない。
なぜなら、無数に存在することが紀元前の昔から知られているからだ\Notes{その証明は蠱惑的であって、数学者を魅了して止まない。(証明)素数は有限であると仮定する。つまり、最大の素数が$M$だとすると素数は$2,3,\ldots,M$しかないとする。このとき$N=2\times3\times\cdots\times{M}+1$は正整数であるが、いずれの素数でも割り切る事が出来ないから$N$も素数。これは素数が有限であるという仮定に反する。よって、素数は無限に存在する。(証明終)}。
素数の数を\ruby{数}{かぞ}える、という試みはそれに遅れること約2000年後、1896年に\IND{素数定理}{そすうていり}(Prime number theorem)として証明された。
「$x$以下の正整数のうち、素数はだいたい$x/\ln x$個ある」というのがその輪郭である。

それでも、素数について人類が知ることは少ない。
「任意の自然数$n$に対して、$n$と$2n$の間には必ず素数が存在する」(\IND{Bertrand–Chebyshevの定理}{Bertrand–Chebyshevのていり}, Bertrand–Chebyshev theorem)が、「任意の自然数$n$に対して、$n^2$と$(n+1)^2$の間には必ず素数が存在する」かは未だ分かっていない(\IND{Legendre予想}{Legendreよそう}, Legendre's conjecture)。
「初項と公差が互いに素である等差数列には無限に素数が存在する」(\IND{算術級数定理}{さんしゆつきゆうしゆうていり}, theorem on arithmetic progressions)が、複数個の等差数列での場合は未解決だ(\IND{Dickson予想}{Dicksonよそう}, Dickson's conjecture)。
\IND{双子素数}{ふたこそすう}(twin prime)\Notes{$p$と$p+2$が共に素数であるような$(p,p+2)$のペアを双子素数と呼ぶ。}が無限に存在するかも、\IND{Sophie Germain素数}{Sophie Germainそすう}(Sophie Germain prime)\Notes{$p$と$2p+1$が共に素数であるような$p$をSophie Germain素数と呼ぶ。}が無限に存在するかも分かっていない。

分からないことだらけだということが分かったので、少しずつでも分かることを明らかにしていこう。
素数の定義の中には、「割り切れる」という概念が登場したが、これも改めて定義しよう。

\begin{Defi}{\IND{約数}{やくすう}(divisor), \IND{倍数}{はいすう}(multiple)}{divisor_multiple}
任意の整数$a$と、任意の正整数$b$に対して、$a=bq$なる整数$q$が存在するとき、$b$は$a$を割り切ると言い、$b \mid a$と書き、$b$を$a$の約数、$a$を$b$の倍数と呼ぶ。
逆に、このような$q$が存在しないとき、$b \nmid a$と書く。
\end{Defi}

約数は、\IND{因数}{いんすう}(factor)あるいは\IND{因子}{いんし}とも呼ぶ。
どんな整数でも1と自分自身は約数であるから、これらを\IND{自明な約数}{しめいなやくすう}と呼び、それ以外の約数を\IND{非自明な約数}{ひしめいなやくすう}と呼ぶこともある。
特に因数、あるいは因子が素数のとき、\IND{素因数}{そいんすう}(prime factor)あるいは\IND{素因子}{そいんし}と呼ぶ\Notes{一方で、「素約数」とは言わない。}。
約数と倍数は、小学校で習ったからいいとして、「割り切れる」「割り切れない」の記号は初めて目にする方が多いだろう。
最初の頃はどっちがどっちか分からなくなるが、そのうち慣れる。
例を挙げれば、$3 \mid 6$であり、$3 \nmid 10$である。

当たり前のことだが、次のことを改めて確認しておこう\Notes{こういう基本的な性質は、\ruby{疎}{おろそ}かにしがちで、最初は読み飛ばしてもよいが、手を動かすことで定義が明瞭に理解できる。}。

\begin{Prop}{}{divisor_basic}
整数$a,b,c$について、次が成り立つ。
\begin{enumerate}
 \item $c \mid b$かつ$b \mid a$ならば$c \mid a$
 \item $b \mid a$ならば、任意の正整数$c$に対して$bc \mid ac$
\end{enumerate}
\end{Prop}

\begin{prProof}{divisor_basic}\;
\begin{enumerate}
 \item 仮定より$b=cq_c, a=bq_b$なる整数$q_a,q_b$が存在する。よって、$a=bq_b=cq_cq_b$となり、整数$q_bq_c$が存在するため、$c \mid a$を得る。
 \item 仮定より$b=aq$なる整数$q$が存在する。両辺に$c$を掛けて$bc=acq$となるため、$bc \mid ac$を得る。
\end{enumerate}
\end{prProof}

約数を列挙するプログラムを作ることは、もはや「Pythonではそういう書き方ができる」ということを知っているかどうかというだけの問題なので、載せるだけに済ませる。

\Algo{約数を列挙する}{divisors}{}

「割り切れる」ことが分かったら、自然に公約数と公倍数の概念に辿り着く。
小学校で習ったものだが、堅苦しく言い換えると次のようになる。

\begin{Defi}{\IND{公約数}{こうやくすう}(common divisor), \IND{公倍数}{こうはいすう}(common multiple)}{common_divisor_multiple}
正整数$a, b, d$について、$d \mid a$かつ$ d \mid b$であるとき、$d$を$a,b$の公約数と呼ぶ。
また、正整数$a, b, l$について、$a \mid l$かつ$b \mid l$であるとき、$l$を$a,b$の公倍数と呼ぶ。
\end{Defi}

\begin{Defi}{\IND{最大公約数}{さいたいこうやくすう}(greatest common divisor), \IND{最小公倍数}{さいしようこうはいすう}(least common multiple)}{greatest_common_divisor}
$a,b$の公約数の中で最大の正整数を最大公約数と呼び、$\gcd(a,b)$と書く。
また、$a,b$の公倍数の中で最小の正整数を最小公倍数と呼び、$\mbox{lcm}(a,b)$と書く。
\end{Defi}

$\gcd(a,b)$は、単に$(a,b)$と書かれることも多い。
書く方は記載量が減って楽になるが、ぱっと見2つの数の組と区別が付かないので、「そういう書き方もあるよ」という紹介に留める。

さらに、$\gcd(a,b)=1$のときを論じることが多いので、特に「互いに素」という名前を付ける。

\begin{Defi}{\IND{互いに素}{たかいにそ}, coprime, relatively prime}{coprime}
$a,b$の最大公約数$\gcd(a,b)$が$1$のとき、$a$と$b$は互いに素であるという。
\end{Defi}

\begin{Exam}{}{common_divisor_common_multiple}\;
\begin{itemize}
\item $6$と$16$の公約数は$1,2$、公倍数は$48, 96, \ldots$。よって、最大公約数$\gcd(6,16)=2$、最小公倍数$\mbox{lcm}(6,16)=48$。
\item $6$と$12$の公約数は$1,2,3,6$、公倍数は$12, 24, \ldots$。よって、最大公約数$\gcd(6,12)=6$、最小公倍数$\mbox{lcm}(6,12)=12$。
\end{itemize}
\end{Exam}

公約数や公倍数の概念は、整数の範囲に拡張することができるが、ここでは正整数の範囲で考えている。

ところで、最大公約数を計算する事は簡単だっただろうか。
最大公約数と最小公倍数それ自体は小学校で習うが、求め方は習わなかった。
雰囲気で数値を推測し、後は頑張るしかなかった。
おそらく他の数式計算のようにシステマティックに行われるのではなく、多分に直観的であったはずだ。
もちろん、コンピュータは「直観」というものを知らない。
コンピュータが最大公約数を求めるためにはどうしたらよいか？　実はその計算方法は、紀元前の昔に知られていて、Euclidの互除法と呼ばれているのである。

\begin{Theo}{\IND{Euclidの互除法}{Euclidのこしよほう}, Euclidean algorithm}{euclidean algorithm}
$a>b>0$について、$\gcd(a,b) = \gcd(a - b, b)$
\end{Theo}

これでどうして最大公約数を求められるのか、一見しただけでは分からない。
余りを求める記号として、$\%$を使うことにする。
つまり、「$a$を$b$で割った余り」は$a \% b$と書くことにするのだ。
$\gcd(a,b)=\gcd(b,a)$であること、$\gcd(0,b)=b$であることを踏まえると、最大公約数は次のように再帰的に計算できる。
\begin{align*}
\gcd(a,b) =
\begin{cases}
b, &\mbox{if } a = 0\\
\gcd(b \% a, a), &\mbox{otherwise}
\end{cases}
\end{align*}

これをコードに落とすと次のようになる。

\Algo{Euclidの互除法}{gcd}{}

さらに、最小公倍数はどうなのかというと、$ab = \gcd(a,b)\mbox{lcm}(a,b)$という関係があるため、最大公約数を求めれば、すぐに求められる。

\Algo{最小公倍数}{lcm}{c.f., \rAlgo{gcd}}

Euclidの互除法は更に面白いことも教えてくれる。
少しプログラムを変更することで、\rTheo{ex_euclid}が得られる。

\begin{Theo}{}{ex_euclid}
整数$a,b$に対して、
\begin{align*}
ax + by = \gcd(a,b)
\end{align*}
を満たすような整数$x,y$が存在する。
\end{Theo}

しかも、存在を示しただけでなく、具体的な値を得るアルゴリズムでもある。
このアルゴリズムは、\IND{拡張Euclidの互除法}{かくちようEuclidのこしよほう}(Extended Euclidean algorithm)と呼ばれる。
$15x+33y=1$を満たす整数$x,y$は存在しないことが分かるし、拡張Euclidの互除法によると、$25x+4y=1$を満たす整数$x,y$は$x=1,y=-6$であることが分かる。

\Algo{拡張Euclidの互除法}{extended_gcd}{}

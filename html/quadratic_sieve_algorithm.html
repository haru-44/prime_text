<html lang="ja">
  <head>
    <script type="text/x-mathjax-config">
       MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML,/www_func/MathJax/MyConfig.js">
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  </head>
  <body>
  <strong>このページは、pdfファイル出力用に作成したtexファイルから機械的に変換されています。体裁不良がある場合は<a href="https://github.com/haru-44/prime_text/releases/latest/download/main.pdf">pdfファイル</a>をご覧ください。</strong>
  <hr/>
<h1>quadratic_sieve_algorithm</h1>
<p>平方差法の原理は既に見た。
\(n=9951\)を素因数分解するとしたとき、
\begin{align*}
9951 &= 10000 - 49\\
&= 100^2 - 7^2\\
&= (100 - 7)(100 + 7)\\
&= 93 \times 107
\end{align*}
を見つけるのであった。
</p>
<p>この原理を深く考察しよう。
一般に、\(x\not\equiv\pm y\pmod{n}\)で、\(x^2\equiv y^2\pmod{n}\)という関係を持つ\(x,y\)を見つければ、非自明な因数が\(\gcd(x-y, n)\)で求められる。
\(9951\)の場合は、\(100^2\equiv7^2\pmod{9951}\)であるから、\(\gcd(100-7, 9951)=93\)が得られる。
</p>
<p><strong>2次篩法</strong>(quadratic sieve algorithm)は、このような\(x,y\)を探すために、次の2次関数を考える。
\begin{align*}
Q(x) = (x + \left \lfloor\sqrt{n}\right \rfloor)^2 - n
\end{align*}
この\(Q(x)\)に\(x=1,2,\ldots\)と次々に代入していき、\(Q(x)\)の値を求める。
\(Q(x)\)を導入した魂胆は、\(x\)が小さいと、\(Q(x)\)も小さくなると期待できるからである。
それはつまり、\(Q(x)\)を素因数分解しやすいと目論むことができるということだ。
実際、\(n=2201\)のとき、
\begin{align*}
Q(1) &\equiv 47^2 \equiv 8 \equiv 2^3\pmod{2201}\\
Q(2) &\equiv 48^2 \equiv 103 \pmod{2201}\\
Q(3) &\equiv 49^2 \equiv 200 \equiv 2^3 \times 5^2 \pmod{2201}\\
Q(4) &\equiv 50^2 \equiv 299 \equiv 13 \times 23 \pmod{2201}\\
\end{align*}
となる。
この\(Q(x)\)が何の役に立つのか、疑問に感じるかもしれないが、既に素因数分解の下準備は完了している。
\(Q(1)\)と\(Q(3)\)をかけると、
\begin{align*}
47^2 \times 49^2 &\equiv 2^6 \times 5^2 \pmod{2201}\\
(47 \times 49)^2 &\equiv (2^3 \times 5)^2 \pmod{2201}
\end{align*}
が得られ、めでたく\(x^2\equiv y^2\pmod{n}\)を満たす\(x=47\times49=2303\), \(y=2^3\times5=40\)が得られた。
よって、\(\gcd(x-y,n) = \gcd(2303-40, 2201) = 31\)という\(2201\)の素因数が求められる。
</p>
<p>以上が、2次篩法の一連の流れである。
つまり、\(Q(x)\)の値を\(x=1,2,\ldots\)の順に計算し、素因数分解する。
この際に、適当な境界値\(B\)以下の素因数に完全に分解できるもののみを残す。
常に、完全な素因数分解が可能というわけではないし、その必要もないので、都合の悪い\(Q(x)\)は捨てるわけだ。
十分な数が集まれば\(n\)の素因数分解に成功する。
</p>
<p>このアウトラインだけでは具体的な実装は不可能だ。
すぐさま沸き起こる疑問として、\(Q(1), Q(2),\ldots\)を計算して、素因数分解したはいいが、そのどれを組み合わせれば\(x^2\equiv y^2 \pmod{n}\)の形になるのだろうか。
問題は、右辺の組み合わせであるが、指数部分がすべて偶数になるようにすればよい。
よって、\((2\)の指数\(\bmod{2}, 3\)の指数 \(\bmod{2}, \ldots)\)という\(\mathbb{F}_2\)のベクトルを考えればよい。
上記の例でいえば、
\begin{align*}
Q(1) &= (1, 0, 0, 0, 0, 0, 0, 0, 0)\\
Q(3) &= (1, 0, 0, 0, 0, 0, 0, 0, 0)\\
Q(4) &= (0, 0, 0, 0, 0, 1, 0, 0, 1)
\end{align*}
を考えるのである(\(Q(2)\)は素因数が大きいため除外した)。
この中で、足してすべて\(0\)になるような組み合わせを見つければよい。
</p>
<p>これは、\(\mathbb{F}_2\)上の連立一次方程式を解くことに他ならない。
そして、線形代数でよく知られるように、\(k\)次のときは\(k+1\)本の式が必要となる。
このためのアルゴリズムとして<strong>Gaussの消去法</strong>が知られている。
</p>


</body></html>
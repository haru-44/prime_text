<html lang="ja">
  <head>
    <title>baillie_psw_test</title>
    <script type="text/x-mathjax-config">
       MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML,/www_func/MathJax/MyConfig.js">
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=py&skin=sunburst"></script>
  </head>
  <body>
  <strong>このページは、pdfファイル出力用に作成したtexファイルから機械的に変換されています。体裁不良がある場合は<a href="https://github.com/haru-44/prime_text/releases/latest/download/main.pdf">pdfファイル</a>をご覧ください。</strong>
  <hr/>
<h1>baillie_psw_test</h1>
<p><strong>Baillie-PSWテスト</strong>(Baillie-PSW primality test)は、大雑把に言えばMiller-RabinテストとLucas数列テストを組み合わせた素数判定法である。
Baillie-PSWテストという名称は、発明者であるRobert Baillie, Carl Pomerance, John Selfridge, Samuel Wagstaffからきている。
元々、3人が発明したPSWテストが存在し、Baillieが改良を加えたため、このような名称となっている。
</p>
<p>Miller-RabinテストもLucas数列テストも、誤って素数と判定されてしまう合成数が存在するが、両方を突破する合成数は感覚的は少ないと推定できるだろう。
もちろん、無闇矢鱈にテストを繰り返せば合成数であるという疑いは徐々に晴れていくものの、それでは芸がない。
Miller-Rabinテストにおいて、\(a=2\)の場合に誤って素数と判定されてしまう合成数は、\(2047, 3277, 4033,\ldots\)等である{<a href="https://oeis.org/A001262">https://oeis.org/A001262</a>}。
一方、適切にパラメータ\(a,b\)を設定されたLucas数列テストにおいて、誤って素数と判定されてしまう合成数は、\(5459, 5777, 10877,\ldots\)等である{<a href="https://oeis.org/A217255">https://oeis.org/A217255</a>}。
この2つを試して間違うときというのは、この2つの数列に共通の数が含まれていた場合のみである。
(現在検証されている範囲では)\(2^64\)までなら確実に素数か合成数かを判定できるし、これ以上についても、そのような合成数は未だ発見されていない。
</p>
<p>Lucas数列テストにおける、適切なパラメータ設定の方法は、いくつかあるが重要なのは\(\Delta=a^2-4b\)が\(\left(\frac{\Delta}{n}\right)=-1\)を満たすということだ。
では\(\Delta\)を決定するための2つの方法が紹介されている。
</p><ul>
 <li> \(\Delta\)を\(5,-7,9,-11,\ldots\)の順番に\(\left(\frac{\Delta}{n}\right)=-1\)を満たしているかを試して、最初に見つけた\(\Delta\)にt対して\(a=1,b=(1-\Delta)/4\)とする。
 <li> \(\Delta\)を\(5,9,13,17,\ldots\)の順番に\(\left(\frac{\Delta}{n}\right)=-1\)を満たしているかを試して、最初に見つけた\(\Delta\)に対して、\(a\)を\(\sqrt{\Delta}\)を超える最小の奇数、\(b=(a^2-\Delta)/4\)とする。
</ul>
<p>同論文では、1つ目の方法で\(\Delta\)を決定するまでの試行回数の期待値は、\(3.147\cdots\)に収束することも証明されている(定理9)。
</p>
<pre class="prettyprint">from miller_rabin_test import miller_rabin_test
from selfridge_method_a import selfridge_method_a
from sqrt_int import sqrt_int
from strong_lucas_sequence_test import strong_lucas_sequence_test


def baillie_psw_test(n: int) -> str:
    """ Baillie-PSWテストを用いて、nが素数かを判定する。

    Args:
        n (int): 素数判定する対象の整数

    Returns:
        str: 'composite number' : nは合成数
             'probable prime'   : nはおそらく素数
             'prime number'     : nは素数

    Examples:
        >>> baillie_psw_test(2021) # 2021 = 43 * 47
        'composite number'
        >>> baillie_psw_test(101) # 101 is prime
        'prime number'
    """
    # 試し割は原理上不要な工程だが、小さな素因数がある合成数について
    # わざわざ以降のテストするまでもない
    for p in [2, 3, 5, 7]:
        if n == p:
            return 'prime number'
        if n % p == 0:
            return 'composite number'
    # 底2のMiller-Rabinテスト
    if miller_rabin_test(n, a_list=[2]) == 'composite number':
        return 'composite number'
    if sqrt_int(n)**2 == n:
        return 'composite number'
    a, b = selfridge_method_a(n)
    if a == 0 and b == 0:
        return 'composite number'
    # 強Lucasテスト
    result = strong_lucas_sequence_test(n, a, b)
    if result == 'composite number':
        return result
    if n <= 2**64:
        return 'prime number'
    else:
        return 'probable prime'
</pre>



</body></html>